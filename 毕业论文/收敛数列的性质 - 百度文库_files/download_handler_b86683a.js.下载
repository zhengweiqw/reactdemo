define("wkview:widget/format_convert/download_handler/download_handler.js",function(e,n,r){var t=e("wkcommon:widget/lib/doT/doT.min.js"),o=function(){};o.prototype={constructor:o,needConvert:function(e,n,r){var t=n.vipHuixueConvert||{};if(0===+t.is_open)return!1;var o=!1,a=e||{};return a.docTypeOrigin&&a.docTypeConvert&&a.docTypeOrigin!==a.docTypeConvert&&!n.downloaded&&r.isVip&&(o=!0),o},isSafari:function(){return navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")},run:function(e,n,r){var o=this,a=n||{};$.eduAjax2({url:e,type:"POST",data:a,dataType:"json",bizSuccess:function(e){var n=e||{},a=JSON.parse(JSON.stringify(n.transDocParams));a.title=encodeURIComponent(a.title),a.tpl="download",a.wp=r.wpsf;var i=[],d="_blank";o.isSafari()&&(d="_self"),$.each(a,function(e,n){i.push({key:e,val:n})});var u=t.template('<form class="form-convert"\n    target="{{=it.target}}"\n    action="/user/browse/huixueconvert"\n    method="POST"\n>\n{{~ it.paramArr :item:i }}<input type="hidden" name="{{=item.key}}" value="{{=item.val}}">\n{{~}}</form>')({paramArr:i,target:d}),c=$(u);$("body").append(c),c.submit()},bizError:function(e){o.handlerError(e)},error:function(e){o.handlerError(e)}})},handlerError:function(e){var n=this,r=e||{},t=r.transDocParams;if(t){var o,a=window.getDonwloadCompletePage,i={};2===+r.error_no&&(i={formatConvertExp:1}),"function"==typeof a&&(o=a(i)),window.location.href=t.transDocBos,setTimeout(function(){if(o)if(n.isSafari()||o.disableBlank)location.href=o.url;else{var e=document.createElement("form");e=document.createElement("form"),e.action=o.url,e.target="_blank",e.method="POST",document.body.appendChild(e),e.submit()}},1200)}},getQuery:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(n);return null!==r?unescape(r[2]):""},handleComplete:function(){var e=this.getQuery("formatConvertExp");1===+e&&$.toast("\u7cfb\u7edf\u9519\u8bef\uff0c\u5df2\u4e3a\u60a8\u4e0b\u8f7d\u539f\u683c\u5f0f\u6587\u6863")}},r.exports=new o});