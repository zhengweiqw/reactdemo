define("wkview:widget/common_toc_reader/reader_xreader/index.js",function(e,t,o){var n=e("wkcommon:widget/lib/tangram/base/base.js"),a=e("wkcommon:widget/ui/js_core/widget/widget.js").widget,i=e("wkcommon:widget/ui/js_core/log/log.js"),r=e("wkcommon:widget/ui/js_core/util/util.js"),g=e("wkcommon:widget/lib/fis/data/data.js"),s=e("wkcommon:widget/ui/js_core/xform/xform.js"),d=e("wkview:widget/common_toc_toolbar/item/zoom/zoom.js").zoom,l=e("wkview:widget/common_toc_toolbar/item/fullScreen/fullScreen.js").fullScreen,c=e("wkview:widget/common_toc_toolbar/item/page/page.js").page,p=e("wkview:widget/common_toc_toolbar/item/praise/praise.js").praise,f=e("wkview:widget/common_toc_toolbar/item/favo/favo.js").favo,u=e("wkview:widget/common_toc_toolbar/item/wangpan/wangpan.js").wangpan,w=e("wkview:widget/common_toc_toolbar/item/appraise/appraise.js").appraise,v=e("wkview:widget/common_toc_toolbar/toolbar/toolbar.js").toolbar,m=e("wkview:widget/common_toc_toolbar/item/coreBtns/coreBtns.js").coreBtns,h=e("wkview:widget/common_toc_toolbar/item/share/share.js").share,P=e("wkview:widget/common_item/autofixed/autofixed.js").autofixed,S=e("wkview:widget/common_item/topMessage/topMessage.js").topMessage,_=e("wkview:widget/common_toc_toolbar/config.js").config,b=e("wkview:widget/common_item/setting/setting.js").setting,k=e("wkview:widget/ui/view/down_wangpan/down_doc.js").downDocCreate(),C=e("wkcommon:widget/ui/lib/cookie/cookie.js"),T=e("wkview:widget/model/vipData.js"),x=0,R=g.get("WkInfo"),j=R.DocInfo,y=(R.UserInfo||{},a({Options:{el:"",doc_id:"",doc_id_update:"",docType:"doc",isLogin:0,zoomLevel:1,startPage:51,pageCount:100},_init:function(){var e=this;if(e.el){e.el=n.dom.g(e.el),e.pageList=n.dom.query(".bd",e.el),e.width=e.el.offsetWidth,e.height=e.el.offsetHeight,e.setting=b,_=r.mix(_,e.options,!0),e.config=_;var t=Math.min(e.startPage+_.pageStep-1,e.pageCount);R.DocInfo.isApi&&(t=e.pageRange+1),e.pageRange=[e.startPage,t],_.pageRange=e.pageRange,_.shareElId=e.shareElId,b.currentZoomLevel=e.zoomLevel,e.prevStartBtn=n.dom.g("prev-pageList-"+e.uid),e.nextStartBtn=n.dom.g("next-pageList-"+e.uid),e._scrollOfPage=null,e.secondClassify=j.cid3||"",_.bookmark=0===e.bookmark[0]?!1:e.bookmark,e.toPage>1&&e.gotoPage(e.toPage),b.currentPage=e.toPage,e.getPageFromPosition(),setTimeout(function(){n.lang.eventCenter.dispatchEvent("ReaderCreate.after",{reader:window.reader?window.reader:e.reader})},100),T.run($.proxy(this.render,this),$.proxy(this.render,this)),i.xsend(1,100037,{secondClassify:e.secondClassify,pn:e.toPage,out:0}),j&&"cqvip"===j.org_engName?i.xsend(1,100780,{index:1}):j&&1===~~j.hasImage&&-1===j.title.indexOf("\u56fe")&&i.xsend(1,100780,{index:2}),$(window).on("viewyuedurenwurukou",function(){s.getJSON("yuedudaoliu_flow",{success:function(e){0===e.yuedurenwu?$(".yuedurenwu_link").hide():1===e.yuedurenwu&&$(".yuedurenwu_link").show()}})})}},render:function(){var e=this;if(e.toolsBar=new v({readerContainer:e,reader:e.reader,items:e.getToolsBarItems()}),e.fullScreen=new l({readerContainer:e,toolsBar:e.toolsBar,reader:e.reader,status:"disabled"}),n.dom.addClass(e.fullScreen.el,"top-right-fullScreen"),e.el.appendChild(e.fullScreen.el),e.resize(),e.fire("onload"),e.bindEvent(),e.initFromName(),e.toPage>1){var t=new S({toolsBar:e.toolsBar,readerContainer:e});t.render()}e.updateScrollOverflow(),n.lang.eventCenter.dispatchEvent("xreaderResizeRight")},initFromName:function(){var e=this;1!==b.currentZoomLevel&&n.lang.eventCenter.dispatchEvent("Reader.initZoom"),e.nameToSetting()&&b.isFullScreen&&n.lang.eventCenter.dispatchEvent("Reader.initFullScreen")},updateScrollOverflow:function(){var e=n.page.getScrollTop(),t=document.body.scrollHeight,o=n.page.getViewHeight();b.scrollBof=0===e,b.scrollEof=e+o===t},bindEvent:function(){var e=this;n.lang.eventCenter.addEventListener("Reader.zoomChange",n.fn.bind(e.resize,e)),n.lang.eventCenter.addEventListener("Reader.zoomChange",n.fn.bind(e.pageResize,e)),n.lang.eventCenter.addEventListener("InFullScreen.before",n.fn.bind(e.setScrollOfPage,e)),n.lang.eventCenter.addEventListener("OutFullScreen.before",n.fn.bind(e.setScrollOfPage,e)),n.lang.eventCenter.addEventListener("InFullScreen.after",function(){return R.DocInfo.isApi?!1:(e.pageResize(),void e.gotoPage(e._scrollOfPage))}),n.lang.eventCenter.addEventListener("wangpan.doc",function(e,t){t=t||{};var o=t.from||!1;"payDialog"===o?k.getFile():k.start()}),n.lang.eventCenter.addEventListener("OutFullScreen.after",function(){e.pageResize(),e.gotoPage(e._scrollOfPage)});var t=0;n.lang.eventCenter.addEventListener("readMoreBtn.after",function(){0===t&&(e.gotoPage(4),t=1)}),n.lang.eventCenter.addEventListener("Reader.fullScreenResize",function(){e.pageResize(),e.reader.setZoom(e.el.offsetWidth)}),e.reader.addEventListener("firstRender",function(e,t){n.lang.eventCenter.dispatchEvent("Reader.firstRender",t)}),e.prevStartBtn&&n.event.on(e.prevStartBtn,"click",function(t){n.event.stop(t);var o=n.event.getTarget(t),a=+n.dom.getAttr(o,"data-prev-page");e.docRefresh(a)}),e.nextStartBtn&&n.event.on(e.nextStartBtn,"click",function(t){n.event.stop(t);var o=n.event.getTarget(t),a=+n.dom.getAttr(o,"data-next-page");e.docRefresh(a)});var o=r.debounce(function(){var t=n.page.getScrollTop();t!==x&&(x=t,e.getPageFromPosition(t))},100);n.event.on(window,"scroll",o),n.on(window,"unload",function(){try{e.reader.dispose()}catch(t){console.log("error")}}),e.wangpanDialog(),$(".reader-end-download").on("click",".reader-download",function(){})},insertTopMsg:function(){var e=this;e.inner.appendChild(e.topMsg),n.event.on(e.topMsg,"click",function(){e.scrollToPosition(0,0)}),n.lang.eventCenter.addEventListener("Reader.scroll",function(t,o){o.isOverflow.Bof||(e.topMsg.style.top=n.page.getScrollTop()+"px")})},getPageFromPosition:function(e){var t,o,a,r=this,g=function(e,t){return t>e?-1:1},s=n.dom.getPosition(r.el).top;e=e&&e-s||n.page.getScrollTop()-s,r.createPagesTop(),o=r.pagesTop.concat([]),o.push(e),o.sort(g),t=n.array.indexOf(o,e),0>=t&&(t=1),a=Math.min(t+_.startPage-1,r.pageCount),+b.currentPage!==+a&&(i.xsend(1,100037,{secondClassify:r.secondClassify,pn:a,out:0}),b.currentPage=a),r.updateScrollOverflow(),n.lang.eventCenter.dispatchEvent("Reader.scroll",{currentPage:b.currentPage,top:e,isOverflow:r.isOverflow()})},getToolsBarItems:function(){var e=this,t=[];return t="1"===j.can_dump?[l,d,p,f,w,e.isPrivate?null:h,u,c,m]:[l,d,p,f,w,e.isPrivate?null:h,c,m]},getPage:function(){return b.currentPage},isOverflow:function(){var e=this,t=n.dom.getPosition(e.el).top,o=n.page.getViewHeight(),a=e.el.offsetHeight,i=n.page.getScrollTop(),r=!1,g=!1;return t>=i&&(r=!0),i+o>=t+a&&(g=!0),{Bof:r,Eof:g}},createPagesTop:function(){var e=this,t=n.dom.getPosition,o=t(e.el).top,a=e.pageList,i=a.length,r=0,g=[];for(i;i>r;r++)g.push(t(a[r]).top-o);e.pagesTop=g,_.pagesTop=e.pagesTop},gotoPage:function(e){var t=this;if(R.DocInfo.isApi)return!1;if(!t.pageInRange(e))return void t.docRefresh(e);var o=n.page.getScrollLeft(),a=e%50-1,i=n.dom.getPosition(t.pageList[0>a?49:a]).top+50,r=t.getPageNo();n.lang.eventCenter.dispatchEvent("pageChange.before",{fromPageNo:r,toPageNo:e})&&(t.scrollToPosition(o,i),n.lang.eventCenter.dispatchEvent("pageChange.after",{fromPageNo:r,toPageNo:e}))},pageInRange:function(e){var t=this,o=t.pageRange;return!(e<o[0]||e>o[1])},docRefresh:function(e){var t=this,o=e,n=location.href.replace(/#/g,""),a=location.pathname,i=n.substr(n.indexOf(a)+a.length).indexOf("?"),r=n.indexOf("pn=");return t.setting.currentPage=e,t.settingToName(),1>o&&(o=1),o>_.pageCount&&(o=_.pageCount),-1===i?void(location.href=n+"?pn="+o):-1!==r?void(location.href=n.replace(/pn=\d*/,"pn="+o)):void(location.href=n+"&pn="+o)},settingToName:function(e){var t=this,o={};e=e||{},o.readerSetting=n.object.extend(e,t.setting),window.name=n.json.stringify(o)},nameToSetting:function(){var e=window.name,t={};return e&&-1!==e.search("readerSetting")?(t=n.json.parse(window.name),n.object.extend(b,t.readerSetting),window.name="",!0):void 0},scrollToPosition:function(e,t){window.scrollTo(e,t)},getPageNo:function(){return b.currentPage},prevScreen:function(){var e=n.page.getScrollLeft(),t=n.page.getScrollTop(),o=n.page.getViewHeight();window.scrollTo(e,t-o+140)},nextScreen:function(){var e=n.page.getScrollLeft(),t=n.page.getScrollTop(),o=n.page.getViewHeight();window.scrollTo(e,t+o-140)},resize:function(){var e=this;e.toolsBar.resize({readerWidth:e.el.offsetWidth,bodyElWidth:n.dom.query(_.bodySelector)[0].offsetWidth})},setScrollOfPage:function(){this._scrollOfPage=b.currentPage},pageResize:function(e,t){var o=this;o.pageResizeTimer&&clearTimeout(o.pageResizeTimer),o.pageResizeTimer=setTimeout(function(){o._pageResize(e,t)},15)},_pageResize:function(){try{var e=this,t=e.pageList,o=0,a=t.length,i=n.page.getScrollLeft(),r=n.page.getScrollTop(),g=n.page.getHeight(),s=r/g;for(a;a>o;o++){var d=t[o],l=100*+parseFloat(n.dom.getAttr(d,"data-scale")).toFixed(2);"pay-page"!==d.id&&"bottom-download"!==d.id&&"longdoc-login-page"!==d.id&&(d.style.height=d.offsetWidth/l*100+"px")}g=n.page.getHeight(),r=g*s,window.scrollTo(i,r),n.lang.eventCenter.dispatchEvent("Reader.pageResize")}catch(c){console.log("error")}},insert:function(e,t){var o=this,a=n.dom.q("reader-page",o.el,"div"),i=a.length;"undefined"==typeof t&&o.append(e),t-=1,t+1>i&&(t=i),0>t&&(t=0);var r=a[t];n.dom.insertAfter(e,r)},prepend:function(e){var t=this;n.dom.insertBefore(e,t.pageList[0])},append:function(e){var t=this;this.insert(e,t.pageList.length-1)},wangpanDialog:function(){C.get("wangpanTipShow")||$(".wangpan-tip").show(),$(document).on("click",".wangpan-tip .btn-close",function(){$(".wangpan-tip").hide(),C.set("wangpanTipShow",1,{expires:864e5})})}},{type:"html_reader"}));(!n.browser.ie||n.browser.ie>7)&&(this.autofixed=new P({el:n.g("fixed-box")})),o.exports.htmlReader=y});