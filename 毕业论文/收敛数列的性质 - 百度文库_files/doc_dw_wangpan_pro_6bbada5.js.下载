define("wkview:widget/doc_dw_wangpan_main/doc_dw_wangpan_pro.js",function(e,o,i){var n=e("wkcommon:widget/lib/tangram/base/base.js"),t=e("wkcommon:widget/ui/js_core/dialog/dialog.js"),d=(e("wkview:widget/ui/view/operate/operate.js"),e("wkcommon:widget/lib/fis/data/data.js")),a=e("wkcommon:widget/ui/js_core/log/log.js"),r=e("wkcommon:widget/ui/js_core/util/util.js"),c=(e("wkcommon:widget/ui/js_core/login/login.js").login,e("wkcommon:widget/ui/lib/cookie/cookie.js"),d.get("WkInfo")),s=e("wkcommon:widget/ui/lib/jquery/jquery.js"),w=(e("wkview:widget/ui/file_downloader_ui/file_downloader_ui.js"),e("wkcommon:widget/ui/lib/cookie/cookie.js"),e("wkview:widget/ui/view/down_doc/down_org_vip.js"),e("wkview:widget/ui/dialog_down_doc/dialog_down_doc.js"),e("wkview:widget/ui/view/down_doc/dialog_down_doc/dialog_down_doc.js"),e("wkview:widget/doc_download_main/submit.js")),u=function(){var e=null;return function(){return e||(e=t.dialogCreate()),e}}(),l=function(){var e=function(){this.init.apply(this)};return s.extend(e.prototype,{userData:{},publicData:{isInit:!1,dialogWindow:!1},init:function(){var e=this;e.WkInfo=c,e.UserInfo=e.WkInfo.UserInfo,e.VipInfo=d.get("WkInfo").VipInfo,e.UserInfo&&(e.isCreater=e.UserInfo.isCreater),e.docSize=(e.WkInfo.DocInfo.size/1024+"").replace(/^(\d+\.\d)\d+$/,"$1"),e.urlInterfaceGetRepeatDown=e.WkInfo.Urls.interfaceGetRepeatDown,e.docId=e.WkInfo.DocInfo.docId,e.isPaymentDoc=e.WkInfo.DocInfo.isPaymentDoc,e.isPaied=e.WkInfo.DocInfo.ispaied,this.publicData.isInit===!1&&(n.lang.eventCenter.addEventListener("wangpan.toGetProFile",function(){e.getFile()}),n.lang.eventCenter.addEventListener("wangpan.checkVipDownload",function(){e.checkVipDownload()}),this.publicData.isInit=!0)},start:function(){var e=this;return e.publicData.dialogWindow=!1,e.UserInfo?void(e.isCreater&&n.lang.eventCenter.dispatchEvent("wangpan.toGetProFile")):void window.location.reload()},dialogDownDoc:function(){var e=this,o=e.WkInfo.DocInfo||{};return o.professionalDoc&&1===+o.professionalDoc?void 0:(e.publicData.dialogWindow.show(function(){}),!0)},checkVipDownload:function(){},getFile:function(e){var o=this,i=!1;"payed"===e?(u().confirm({title:"\u4e0b\u8f7d\u6587\u6863",content:'<iframe width="460" height="220" name="runDown" frameborder="0"></iframe>',width:500,height:220,onRendered:function(){o.postGetFile()}}),u().hide()):(u().confirm({title:"\u4e0b\u8f7d\u6587\u6863",content:'<iframe name="runDown" frameborder="0"></iframe>',width:500,btnText:["\u4e0b\u8f7d","\u53d6\u6d88"],onRendered:function(){o.postGetFile(),i||(i=!0,"1"===document.downloadForm.storage.value&&n.ajax.get("/user/submit/foldutimeupdate?atype=updateFoldUTime&fold_id=0&_t="+(new Date).getTime()))},onOk:function(){o.postGetFile(),"first"!==e&&"ticket"!==e||i||(i=!0,"1"===document.downloadForm.storage.value&&n.ajax.get("/user/submit/foldutimeupdate?atype=updateFoldUTime&fold_id=0&_t="+(new Date).getTime()))}}),u().hide())},bindSaveEvent:function(){var e=u().el,o=n.dom.getAttr(e,"data-is-bind-save");"binded"!==o&&(r.delegate(e,".choice-for-saved","click",function(){this.checked?document.downloadForm.storage.value=1:(document.downloadForm.storage.value=0,a.send("down","cancel_copy"))}),n.dom.setAttr(e,"data-is-bind-save","binded")),document.downloadForm.storage.value=1},postGetFile:function(){var e=this,o=0,i=e.WkInfo.DocInfo.size;a.send("down","down_doc_tongji",{size:i,useMutli:o});var t=window.postVcode||0,d=window.postVinput||0;s(document.downloadForm).find("input[name=v_code]").val(t),s(document.downloadForm).find("input[name=v_input]").val(d),n.lang.eventCenter.dispatchEvent("wangpan.realStart",{hasActivityAferDownload:e.userData.hasActivityAferDownload});var r=e.userData.isvip||e.userData.is_edu_vip||e.userData.is_jiaoyu_vip,c=r&&e.userData.isVipDocLimited;if(e.isEduLimitedDoc&&e.endTime&&c){var u=s(document.downloadForm);u.attr("action","/user/submit/downloadnew"),u.append('<input type="hidden" name="down_process" value="10">')}w.run(document.downloadForm)}}),e}(),f=function(){var e=l,o=new e;return o};i.exports.downDocCreate=f,i.exports.downDoc=l});