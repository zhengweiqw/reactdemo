define("wkview:widget/raw_income/raw_income.js",function(e,t,i){function n(e){this.options=e||{},this.step2Tmpl=a.template('<div class="WkDownload-activity">\n<div class="dialog-ad dialog-ad-nomarl">\n<div class="donwload-activity-dialog-container">\n<div class="myclose"></div>\n<div class="income-close-btn verify-close-btn" data-fun="close-dialog"></div>\n<div class="dialog-left-greenbar"></div>\n<div class="dialog-top">\n<p class="doc-title" rel="new-dialog" alt="dialog_tit">{{=it.tmpdata.step2.title}}</p>\n</div>\n<div class="dialog-inner tac">\n<div id="giftform">\n{{~it.tmpdata.step2.collectList:value:index}}<div class="formgroup {{=value.className}}">\n{{? value.type == \'options\'}}<div class="ui-bz-select"><p class="ui-bz-select-word" data-fun="select">{{=value.title}}</p>\n<ul class="ui-bz-select-option">\n{{~value.list:valuelist:indexlist}}<li><a href="javascript:;" data-fun="choice" data-value="{{=valuelist.value}}">{{=valuelist.value}}</span></a></li>\n{{~}}</ul>\n<input type="text" name="{{=value.name}}" class="ipt-hide">\n</div>\n{{??}}<input type="text" placeholder="{{=value.title}}" name="{{=value.name}}" class="txt_usname fixplaceholder"/>\n{{?}}</div>\n{{~}}<div class="formgroup">\n<input class="ui-bz-ipt ui-bz-ipt-bgw fixplaceholder" type="text" placeholder="\u8bf7\u586b\u5199\u624b\u673a\u53f7\u7801" name="phone" autocomplete="off">\n<div class="sug phone-sug"></div>\n<span class="errorinfo">\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7</span>\n</div>\n<div class="formgroup" style="display: none;">\n<div class="tel-wrap">\n<input class="ui-bz-ipt ui-bz-ipt-bgw fixplaceholder" type="text" placeholder="\u8bf7\u586b\u5199\u624b\u673a\u9a8c\u8bc1\u7801" name="phone_vcode" style="width: 139px;">\n<a href="javascript:;" class="ui-bz-btn-normal ui-bz-btn-51offer">\n<b class="ui-bz-btn-p-15 ui-bz-btc" data-fun="get-smsg">\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801</b>\n</a>\n</div>\n<span class="errorinfo" id="telerror">\u8bf7\u586b\u5199\u6b63\u786e\u624b\u673a\u9a8c\u8bc1\u7801</span>\n</div>\n<div class="formgroup form-err-group">\n<span class="errorinfo"></span>\n</div>\n<div class="formgroup">\n<div class="formgroup-privacy">\n<span class="please-select" data-fun="please-select"></span>\n\u6211\u4e86\u89e3\u672c\u9875\u4fe1\u606f\u53bb\u5411\u3002<span class="privacy-protection">\u9690\u79c1\u4fdd\u969c<span>\u60a8\u586b\u5199\u7684\u8054\u7cfb\u4fe1\u606f\u5c06\u7531{{=it.tmpdata.adname}}\u83b7\u53d6\u5e76\u53ef\u80fd\u76f4\u63a5\u5411\u60a8\u81f4\u7535\uff0c\u5982\u60a8\u4e0d\u5e0c\u671b\u6253\u6270\uff0c\u8bf7\u52ff\u4f7f\u7528\u8be5\u670d\u52a1</span>\n</span>\n</div>\n</div>\n</div>\n{{? it.index == 3}}<div class="public-tip public-tip-v2">\n{{=it.tmpdata.advertiser_step2.before}}<span class="name">{{=it.tmpdata.advertiser_step2.name}}</span>\n{{=it.tmpdata.advertiser_step2.after}}<span class="private">\n&nbsp;\u9690\u79c1\u4fdd\u969c<div class="hover-tip-hujiang">\n<span class="arrow-icon"></span>\n{{=it.tmpdata.privacy_policy}}</div>\n</span>\n</div>\n<a href="javascript:;" class="ui-bz-btn-senior btn-diaolog-downdoc"><b class="ui-bz-btn-p-16 ui-bz-btc" data-fun="submit-info">\u514d\u8d39\u9884\u7ea6</b></a>\n{{?}}                {{? it.index == 1}}<a href="javascript:;" class="ui-bz-btn-senior btn-diaolog-downdoc"><b class="ui-bz-btn-p-16 ui-bz-btc" data-fun="submit-info">\u514d\u8d39\u4e0b\u8f7d</b></a>\n{{?}}</div>\n</div>\n</div>\n</div>\n<div class="WkDownload-activity-iframe">\n<iframe allowTransparency="true" src="" frameborder="0" scrolling="no"></iframe>\n</div>\n'),this.init()}{var o=e("wkcommon:widget/ui/lib/jquery/jquery.js"),a=e("wkcommon:widget/lib/doT/doT.min.js"),s=e("wkcommon:widget/lib/tangram/base/base.js"),r=e("wkcommon:widget/ui/js_core/log/log.js"),l=(e("wkcommon:widget/ui/js_core/dialog/dialog.js"),e("wkcommon:widget/ui/js_core/_dialog/_dialog.js")),d=e("wkcommon:widget/lib/fis/data/data.js");e("wkcommon:widget/ui/lib/jquery_xdomainrequest/xdomainrequest.js")}n.prototype={init:function(){var e=this;e.addEventListener()},getHTML:function(e){var t="step"+(e||2)+"Tmpl";return this[t]({type:e||0,activity_id:this.activity_id})},closeDialog:function(e){var t=this;o(".WkDownload-activity, .WkDownload-activity-iframe").remove(),"function"==typeof e&&e(t)},showDialog:function(){var e=this,t=(o(window).height(),l.customDialog);new t({width:481,content:e.step2Tmpl({index:e.options.index,tmpdata:e.options}),closeSelector:".myclose",mask:{bgColor:"transparent"}}),3==e.options.index&&r.xsend(1,101105,{id:e.options.adId,index:3}),e.placeholder()},getPhoneMsg:function(e){o.get("/org/interface/getphone?&t="+Math.random(),function(e){0===e.errno&&e.data.securemobil&&!e.data.is_same&&o(".phone-sug").html(e.data.securemobil)})},addEventListener:function(){var e=this;o("body").on("click",".dialog-ad",function(t){var i=o(t.target),n=i.attr("data-fun");switch(n){case"submit-info":var a={},s=e.getFormData();if(a.mobile=s.phone,a.unit_id=e.options.unitid,a.phone_vcode=s.phone_vcode,a.keyword=e.options.keyword,a.province_id=e.options.city,a.title=d.get("WkInfo").DocInfo.title,o(".select-no").length>0)return void alert("\u8bf7\u5148\u9009\u4e2d\u4e86\u89e3\u672c\u9875\u4fe1\u606f\u53bb\u5411");var l=document.cookie,c=l.indexOf("cpladtime");if(-1===c)return void alert("\u9875\u9762\u5df2\u5931\u6548\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u9875\u9762\u540e\u586b\u5199");if(""===s.phone_vcode)return void e.showErr("phone_vcode");if(void 0!==s.filter&&""===s.filter)return void alert("\u8bf7\u5148\u586b\u5199\u5b8c\u6574\u95ee\u5377\u8c03\u67e5");a.phone_vcode=s.phone_vcode,delete s.phone_vcode,a.clues_data=s,3==e.options.index&&r.xsend(1,101105,{id:e.options.adId,index:4}),o(".form-err-group").removeClass("err"),o.ajax({type:"get",url:"https://contentad.baidu.com/delivery/user/wkcplclueadd",data:a,dataType:"json",success:function(t){var n=t.status.code;if(0===n){i.attr("data-fun",""),e.options.step2.download_url&&e.godownload(e.options.step2.download_url),(!s.filter||s.filter&&"\u662f"===decodeURI(s.filter))&&e.visitUrl(e.options.actionurl);var a=setTimeout(function(){clearTimeout(a),e.gonext()},1e3)}else o(".form-err-group .errorinfo").html(t.status.msg||"\u7cfb\u7edf\u7e41\u5fd9, \u8bf7\u7a0d\u540e\u91cd\u8bd5"),o(".form-err-group").addClass("err")}});break;case"get-smsg":var p=o(".dialog-ad input[name=phone]");if(!e.isTel(p.val()))return void p.css("border-color","red").siblings(".errorinfo").css("display","block");i.parent().addClass("ui-bz-btn-disable"),i.attr("data-fun","");var u="\u79d2\u540e\u91cd\u53d1",v=120;o.ajax({type:"get",url:"https://contentad.baidu.com/delivery/tool/sendauthcode",data:{mobile:p.val(),no_decode:1,valid_time:120},dataType:"json",success:function(t){var n=+t.status.code;if(0!==n){o("#telerror").html(t.status.msg),e.showErr("phone_vcode");var a=setInterval(function(){clearInterval(a),i.parent().removeClass("ui-bz-btn-disable"),i.text("\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801").attr("data-fun","get-smsg")},3e3)}else var s=setInterval(function(){v?(i.text(v+u),v--):(clearInterval(s),i.parent().removeClass("ui-bz-btn-disable"),i.text("\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801").attr("data-fun","get-smsg"))},1e3)}});break;case"choice":var f=i.attr("data-value"),m=i.text(),h=i.parents(".ui-bz-select");h.find(".ui-bz-select-word").text(m),h.find(".ipt-hide").val(f),h.find(".ui-bz-select-option").hide(),e.rmErr(h.find(".ipt-hide").attr("name"));break;case"please-select":i.hasClass("select-no")?i.removeClass("select-no"):i.addClass("select-no")}}),o("body").on("blur","input[name=phone]",function(){var t=o(this),i=t.val();return e.rmErr("phone"),e.isTel(i)?void 0:void e.showErr("phone")}),o("body").on("blur","input[name=phone_vcode]",function(){var t=o(this).val();e.rmErr("phone_vcode"),o.trim(t)||(o("#telerror").html("\u9a8c\u8bc1\u7801\u4e3a\u7a7a"),e.showErr("phone_vcode"))}),o("body").on("keyup blur change",".dialog-ad .ic-name",function(){o.trim(o(this).val())?e.rmErr("name"):e.showErr("name")}),o("body").on("keyup blur change",".dialog-ad input[name=phone]",function(t){t.preventDefault();var i=o(this).val(),n=o(".phone-sug").html(),a=new RegExp("^"+i);return i===n?(o(".phone-sug").hide(),void o(".tel-wrap").parent().hide()):(e.isTel(i)&&i!==n&&o(".tel-wrap").parent().show(),i?void(a.test(n)?o(".phone-sug").show():o(".phone-sug").hide()):void o(".phone-sug").hide())}),o("body").on("click",".verify-close-btn",function(){o(".myclose").trigger("click"),o(".ys-ads-mask").hide()}),o("body").on("click",".phone-sug",function(){o(".dialog-ad input[name=phone]").val(o(this).html()),o(".dialog-ad input[name=phone]").trigger("blur"),o(this).hide()}),o("body").on("focus","#giftform input",function(){o(".form-err-group").removeClass("err")}),o("body").on("click",".formgroup .ui-bz-select",function(){o(this).find(".ui-bz-select-option").show()}),o("body").on("mouseleave",".formgroup .ui-bz-select",function(){o(this).find(".ui-bz-select-option").hide()})},cancleEvent:function(){o("body").off("click",".phone-sug"),o("body").off("click",".verify-close-btn"),o("body").off("keyup blur change",".dialog-ad input[name=phone]"),o("body").off("blur","input[name=phone_vcode]"),o("body").off("blur","input[name=phone]"),o("body").off("click",".dialog-ad")},getFormData:function(){var e=o("#giftform").find(":input").serializeArray();return this.serialize2obj(e)},serialize2obj:function(e){for(var t={},i=0;i<e.length;i++)t[e[i].name]=encodeURIComponent(e[i].value);return t},checkData:function(e){var t=this,i=[];return t.isTel(e.phone)||(t.showErr("phone"),i.push("phone")),i.length?(t.showErr(i),!1):!0},gonext:function(){var e=this;r.xsend(1,100896,{id:e.options.ad_id}),o(".myclose").trigger("click"),new l.customDialog({width:465,height:230,content:e.options.downloadTpl({list:0,tmpdata:e.options}),closeSelector:".myclose",mask:{bgColor:"transparent"}})},godownload:function(e){var t='<iframe allowTransparency="true" src="'+e+'" frameborder="0" scrolling="no"></iframe>';o("body").append(t)},isTel:function(e){return!!e.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/)},placeholder:function(){+s.browser.ie<=9&&o(".fixplaceholder").each(function(e,t){var i=o(t).attr("placeholder");o(t).val(i).click(function(){o(this).val()===i&&o(this).val("")}).blur(function(){var e=o(this).val();o.trim(e)||o(this).val(i)})})},showErr:function(e){var t=typeof e;if("string"===t)o("input[name="+e+"]").parents(".formgroup").addClass("err");else if("object"===t)for(var i=e.length-1;i>=0;i--)o("input[name="+e[i]+"]").parents(".formgroup").addClass("err")},rmErr:function(e){var t=typeof e;if("string"===t)o("input[name="+e+"]").parents(".formgroup").removeClass("err");else if("array"===t)for(var i=e.length-1;i>=0;i--)o("input[name="+e[i]+"]").parents(".formgroup").removeClass("err")},visitUrl:function(e){if(e){var t=new Image;return t.src=e,t}}},i.exports=n});