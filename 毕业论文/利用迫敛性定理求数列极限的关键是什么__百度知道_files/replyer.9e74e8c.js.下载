;/*!question-new:widget/ask/replyer/replyer.js*/
define("question-new:widget/ask/replyer/replyer",function(e){function t(e){var t=_.get("IKNOW_QB_ANSWER_AUTOSAVE")||{};t[e]&&t[e][j]&&delete t[e][j],_.set("IKNOW_QB_ANSWER_AUTOSAVE",t)}function i(){var e=_.get("IKNOW_QB_ANSWER_AUTOSAVE")||{},t="1"===F.context("user").isLogin?N:"nologin";e[t]&&e[t][j]&&(k=k||o(),h.addKey({auto_expand_editor:1}),m(".wgt-search-relate, .search-relate").show(),I="up",k.addListener("ready",function(){k.setEditorContent(e[t][j].content)}))}function o(e){var t="1"===F.context("user").isLogin,i="1"===F.context("page").isAdopted,o="1"===F.context("newbest"),a=(F.context("page").supply,["该提问求助发自手机，请精简回答，方便查看","这个问题你有什么看法，展开讲讲...","提问者正在等待您的回答","请输入您的回答...","详细的问题说明，有助于回答者给出准确的答案","1.步骤类：①整体简介②所需工具/原料③方法/步骤④注意事项<br>2.常识类：①直接回答问题②详细给出具体原因/理由/介绍<br>3.原因类：①详细解释原因/理由②提供有效解决方案（构成见步骤类）<br>4.其他类型详见高质量标准（点击回答框右侧图片）"]),n="";n=o?a[1]:t&&i?a[3]:a[2];var s=["fullscreen","bold","italic","paragraph","insertorderedlist","insertunorderedlist","blockquote","|","link","insertimage","insertvideo","map","template"];"74"===F.context("page").cidTop&&s.push("|","insertcode");var r=g.getEditor("answer-editor",{initialFrameWidth:"100%",initialFrameHeight:280,toolbars:[s],initialContent:e?e:n,maximumWords:9999,token:F.context("user").stoken});r.iknowInit({isLogin:t,submitBtn:"提交回答",anonymouse:!0},function(e){e&&m(e).click(u);var t=m(e).closest(".addons");t.append('<p class="answer-editstatus">'+T+"</p>")});var c=!1,l=function(){c||(c=!0,h.send({action:"input",area:"answer-editor"}))},d=function(){O&&clearTimeout(O),O=setTimeout(function(){var e=k.getEditorContent(),t=_.get("IKNOW_QB_ANSWER_AUTOSAVE")||{},i={time:(new Date).getTime(),content:e,key:j},o="1"===F.context("user").isLogin?N:"nologin";if("1"===F.context("user").isLogin&&t[N])t[N][j]=i,!m.trim(e)&&t[N][j]&&delete t[N][j];else if("1"===F.context("user").isLogin){if(!m.trim(e))return;t[N]={},t[N][j]=i}else if(t.nologin)t.nologin[j]=i,!m.trim(e)&&t.nologin[j]&&delete t.nologin[j];else{if(!m.trim(e))return;t.nologin={},t.nologin[j]=i}_.set("IKNOW_QB_ANSWER_AUTOSAVE",t),m("#answer-editor").find(".answer-editstatus").html(T).show(),S&&clearTimeout(S),S=setTimeout(function(){clearTimeout(S),m("#answer-editor").find(".answer-editstatus").html(C)},800);var a=m.object.values(t[o]),n=a.length,s=10;if(n>s){a=a.sort(function(e,t){return e.time-t.time});for(var r=0;n-s>r;r++)delete t[o][a[r].key];_.set("IKNOW_QB_ANSWER_AUTOSAVE",t)}},1e3)};return r.addListener("contentChange",l),r.addListener("contentChange",d),r}function a(){m(k.container).hasClass("iknow-editor-fullscreen")&&k&&k.submitBtn&&(k.submitBtn.style.display="none");var e=m(".layerBg"),t=m("#edui1"),i=t.width()-2,o=t.height()-2,a="height:"+o+"px;width:"+i+"px";if(e.length)e.attr("style",a).show();else{var n=m("<div style='"+a+"' class='layerBg'></div>"),s=m("<span class='loading-layer'></span>");t.append(n,s)}}function n(e,t){if(m(".loading-layer").hide(),m(".layerBg").hide(),m("."+e).length)m("."+e).show();else{var i=m("#edui1"),o=i.width()-2,a=(i.height()-2,m("<div class='tipLayer'></div>"));i.append(a);var n=m(".tipLayer");n.attr("class","tipLayer "+e).html("<span class='icon'></span><div>"+t+"</div>"),n.css("margin-left",(o-m(".tipLayer").width())/2+"px")}}function s(e){var t="",i=[],o=E.length;m(".loading-layer").hide(),m(".layerBg").hide(),o.length<=3?(m.each(E,function(e,i){t+=['<div class="visit-join-model-item">','<a target="_blank" href="/uteam/view?teamId='+i.teamId+'" class="visit-join-model-img"><img src="'+i.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+i.teamId+'">'+(i.teamName.length>7?i.teamName.slice(0,7):i.teamName)+"</a></h3>","<p><span>"+i.cname+"</span>"+i.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+i.teamId+'" class="visit-join-model-btn">加入</a></div>'].join("")}),i.push(t)):m.each(E,function(e,a){t+=['<div class="visit-join-model-item"><a target="_blank" href="/uteam/view?teamId='+a.teamId+'" class="visit-join-model-img"><img src="'+a.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+a.teamId+'">'+(a.teamName.length>7?a.teamName.slice(0,7):a.teamName)+"</a></h3>","<p><span>"+a.cname+"</span>"+a.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+a.teamId+'" class="visit-join-model-btn">加入</a></div>'].join(""),((e+1)%3===0&&0!==e||e===o-1)&&(i.push(t),t="")}),b.alert(B.html(),{className:"visit-join-model-wrap",title:"回答已提交",width:500,height:396,open:function(){var t,a,n=m("#visit-join-model-content");A||(A=new v({direction:"horizontal",controls:!1,activeIndex:0,items:i,interval:0}),A.render(n)),t=n.find(".visit-join-model-btn"),t.click(function(){var e=m(this);e.hasClass("visit-join-model-active")?e.removeClass("visit-join-model-active"):(t.removeClass("visit-join-model-active"),e.addClass("visit-join-model-active"))}),a=n.find(".visit-join-control"),3>=o?a.hide():a.click(function(){var e=m(this),t=e.data("action"),i=0,o=A.items.length;"left"===t?e.hasClass("visit-join-control-left-disable")||(A.prev(),i=A.getActiveIndex()-1,0>=i?e.addClass("visit-join-control-left-disable"):e.removeClass("visit-join-control-left-disable"),e.siblings().removeClass("visit-join-control-right-disable")):e.hasClass("visit-join-control-right-disable")||(A.next(),i=A.getActiveIndex()+1,i>=o-1?e.addClass("visit-join-control-right-disable"):e.removeClass("visit-join-control-right-disable"),e.siblings().removeClass("visit-join-control-left-disable"))}),m(".visit-join-model-wrap .ui-dialog-titlebar-close").click(function(){m.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){var t,i=m("#visit-join-model-content"),o=i.find(".visit-join-model-btn"),a=m("#visit-join-warn");o.each(function(){var e=m(this);return e.hasClass("visit-join-model-active")?(t=e,!0):void 0}),t?(m.post("/uteam/submit/applyJoin",{fr:"recalert",teamId:t.data("teamid")},function(t){"string"==typeof t&&(t=m.parseJSON(t)),b.close(),0!==t.errno?b.alert(t.errmsg,{className:"visit-join-model-error",open:function(){m(".visit-join-model-error .ui-dialog-titlebar-close").click(function(){m.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){m.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()}}]}):(m.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e())}),h.send({module:"question",action:"visit-join",page:"unview",area:"join-alert"})):(a.animate({height:24}),setTimeout(function(){a.animate({height:0})},1e3))}}]}),h.send({module:"question",action:"visit-join",page:"unview",area:"alert"})}function r(e){h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsHatch:1});var t=w(m("#replyer-addtags-tmpl").html());m("body").append(t.render(e));var i=Number(_.get("showCount"))+1;_.set("showCount",i),m(".tags-box").on("click","li",function(){var e=m(this);e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")}),m(".addtags-box").on("click",".addtags-close",function(){m(".addtags-box").remove(),location.reload()}).on("click",".addtags-notip",function(){m(".addtags-box").remove(),h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsNotip:1}),_.set("addtagsHatch","notip"),location.reload()}).on("click",".addtags-sub",function(){var e=c();0===e.length?(h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",notAddtags:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()):(h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",hasAddtags:1}),m.ajax({url:"/submit/user",type:"post",dataType:"json",data:{cm:100522,tags:e,stoken:F.context("user").stoken}}).done(function(e){0===e.errorNo?setTimeout(function(){window.location="https://zhidao.baidu.com/ihome#body"},500):b.alert(e.errorMsg)}).fail(function(){b.alert("网络故障，请重试")}))})}function c(){var e=[];return m(".tags-box li").each(function(){var t=m(this);t.hasClass("selected")&&e.push(t.text())}),e.join("	")}function l(){h.addKey({subHatch:1});var e=w(m("#replyer-tags-tmpl").html());m("body").append(e.render()),_.set("subshowCount",Number(_.get("subshowCount"))+1),m(".tags-content").on("click",".tags-close",function(){m(".tags-box").remove(),location.reload()}).on("click",".tags-notip",function(){m(".tags-box").remove(),h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subaddtagsNotip:1}),_.set("skipHatch","notip"),location.reload()}).on("click",".tags-sub",function(){h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subHatchskip:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()})}function d(){var e=location.href;e.indexOf("hideOtherAnswer")<0?(e.indexOf("#")>0&&(e=e.substring(0,e.indexOf("#"))),location.href=e+=e.indexOf("?")>0?"&hideOtherAnswer=true&newAnswer=1":"?hideOtherAnswer=true&newAnswer=1"):location.reload()}function u(e){if(e.preventDefault(),!L){L=!0,setTimeout(function(){L=!1},1e3);var i={cm:100009,qid:F.context("page").qid,title:F.context("extra").title,answerfr:F.context("extra").answerfr,feedback:F.context("feedback"),entry:F.context("extra").entry},o=m.url.getQueryValue(location.href,"youliao_id");if(o&&(i.youliao_id=o),0==F.context("user").isNew&&0!=m.cookie.get("IK_FORCE_UHOME")&&m.cookie.set("IK_FORCE_UHOME","0",{expires:31536e6,path:"/"}),k.checkEditor()){var c=k.getEditorContent();i.co=c,i.cite="",i.rich=1,i.edit="new",k.authcode&&k.authcode.submitParam(i),k.anonymouse&&k.anonymouse.checked&&(i.anoy=1);var u="";i.co&&i.co.match(/<strong>/)&&i.co.match(/<em>/)?u="both":i.co&&i.co.match(/<strong>/)?u="replyBold":i.co&&i.co.match(/<em>/)&&(u="replyRed"),h.send({area:"answer_submit_btn",action:"answer",privilegeSubmit:u,uid:F.context("user").uid}),a(),p.fire("login.check",{isLogin:function(e){function o(){new f({params:i,hasJump:!1,syncId:"answer",jumpSubmitDelay:4500,beforeJump:function(e,i){t(N),i.qid&&i.aid&&_.set("IKNOW_PC_BONUS_QB",{qid:F.context("page").qid,rid:i.aid}),0==F.context("user").isNew&&0==F.context("user").isHaveCid&&m.ajax({type:"post",url:"/submit/user",data:{cm:100522,word:F.context("page").cid,stoken:F.context("user").stoken}});var o="normal";if(m("#answer-for-lottery").size()){var a=w(m("#answer-for-lottery").html());o="datichoujiang",m("body").append(a.render(i)),m(".affairs-box").on("click",".affairs-close",function(){m(".affairs-box").remove(),d()})}else if(E&&E.length&&"show"!==m.cookie.get("VISIT_VISIT_MODEL"))s(function(){d()});else{_.get("showCount")||_.set("showCount",0),_.get("subshowCount")||_.set("subshowCount",0);var c=!F.context("user").tag&&"notip"!==_.get("addtagsHatch")&&_.get("showCount")<2,u=F.context("user").tag&&0!==F.context("user").tag.length&&"notip"!==_.get("skipHatch")&&_.get("subshowCount")<2;c&&"true"===F.context("isUnview")?m.ajax({url:"/misc/getrecommendtag",type:"post",dataType:"json",data:{qid:F.context("page").qid}}).done(function(e){0===e.error?r(e.data):b.alert(e.errorMsg)}).fail(function(){b.alert("网络故障，请重试")}):u&&"true"===F.context("isUnview")?l():(n("success-tip","您的回答已提交成功"),setTimeout(function(){d()},2e3))}h.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",rid:i.aid,qid:F.context("page").qid,beforeDialog:o})},beforeError:function(){m(".loading-layer").hide(),m(".layerBg").hide(),h.send({area:"submit",action:"submit-error"})},authcode:k.authcode||null})}localStorage.removeItem("HAS_NOT_COMMIT_ID"),localStorage.removeItem("HAS_NOT_COMMIT_CONTENT"),1===e.isRealName&&0===m("#passport-accRealName-pop").length?p.fire("login.realName",{onHide:function(){m(".loading-layer").hide(),m(".layerBg").hide()},onSubmitSuccess:function(){o()}}):1===e.isRealName&&m("#passport-accRealName-pop").length>0?(m("#passport-accRealName-pop").show(),m("body").children("div:first-child").show(),m("#passport-accRealName-pop").is(":hidden")?(m(".loading-layer").hide(),m(".layerBg").hide()):(m(".loading-layer").show(),m(".layerBg").show())):o()},noLogin:function(){m(".loading-layer").hide(),m(".layerBg").hide(),localStorage.setItem("HAS_NOT_COMMIT_ID",F.context("page").qid),localStorage.setItem("HAS_NOT_COMMIT_CONTENT",i.co),h.send({area:"answer_click_loginpop",action:"pv"}),p.fire("login.log",{onLoginSuccess:function(e){e&&(F.context("user").stoken=e.stoken),1===e.isRealName?(m(".loading-layer").hide(),m(".layerBg").hide()):new f({params:i,hasJump:!1,syncId:"answer",beforeJump:function(e,i){t("nologin"),i.qid&&i.aid&&_.set("IKNOW_PC_BONUS_QB",{qid:F.context("page").qid,rid:i.aid}),h.send({area:"submit",action:"unlogin-submit-success"}),E&&E.length&&"show"!==m.cookie.get("VISIT_VISIT_MODEL")?s(function(){d()}):(n("success-tip","您的回答已提交成功"),setTimeout(function(){d()},2e3))},beforeError:function(){m(".loading-layer").hide(),m(".layerBg").hide(),h.send({area:"submit",action:"unlogin-submit-error"})},authcode:k.authcode||null})}})}})}}}var m=e("common:widget/js/util/tangram/tangram"),g=e("common:widget/js/logic/ueditor/ueditor"),h=e("common:widget/js/util/log/log"),p=e("common:widget/js/util/event/event"),f=e("common:widget/js/logic/submit/submit"),b=e("common:widget/js/ui/dialog/dialog"),v=e("common:widget/js/ui/carousel/carousel"),w=e("common:widget/lib/juicer/juicer"),_=e("common:widget/js/util/store/store"),x=e("question-new:widget/ask/editor-guide/editor-guide"),y=m("#answer-bar"),I="down",k=null,j=""+F.context("page").qid,N=""+F.context("user").uid,T='<i class="iknow-icons answer-editing-icon">&#xe630;</i>回答自动保存中',C="你输入的回答已保存",O=null,S=null;i();var q={ql:/browse(?:\/\d+(?:$|\?lm=2|\?[^lm])|$|\/$|\/\?lm=2)/i,ql_tab_hscore:/browse\/\d*\?lm\=4/,ql_tab_zero:/browse\/\d*\?lm\=8/,ql_tab_emergency:/browse\/\d*\?lm\=16/,zhuanti:/zhidao\.baidu\.com\/s\/([a-zA-Z0-9_\-]+)/,search:/zhidao\.baidu\.com\/search/};!function(){var e,t=document.referrer,i="";for(var o in q)if(e=t.match(q[o])){i=o;break}if(i&&"zhuanti"==i&&(i=e[1]),!i){var a=m.url.queryToJson(location.search||"");a&&"uc_push"==a.fr&&(i="keyword"==a.push?"uc_tab_keyword":"category"==a.push?"uc_tab_class":"uc_tab_recommand")}var n=F.context("page").isFromWap,s=i+(parseInt(n)?";wap_question_replyed":"");F.context("extra",{title:s,answerfr:s})}(),h.addKey({has_better_answer_btn:y.length&&y.is(":visible")?1:0}),y.click(function(){var e=m(this).text();h.send({module:"question",action:"click",page:"replyer",area:"have-better-answer-btn",btn_type:e,isLogin:"1"===F.context("user").isLogin?1:0}),k=k||o(),"down"===I?(k.expandEditor(function(e){e.style.overflow="inherit",m("#answer-editor").css({visibility:"inherit"})}),I="up",m(".wgt-search-relate, .search-relate").show()):(k.collapseEditor(function(e){e.style.overflow="hidden",m("#answer-editor").css({visibility:"hidden"})}),I="down",m(".wgt-search-relate, .search-relate").hide())}),function(){var e={home:/zhidao\.baidu\.com\/$/,browse:/zhidao\.baidu\.com\/browse/,ihome:/zhidao\.baidu\.com\/ihome(?!\/hangjia)/,qb:/zhidao\.baidu\.com\/question/,hangjia:/zhidao\.baidu\.com\/mavin\/home\/index/,team:/zhidao\.baidu\.com\/team/},t=location.href,i=document.referrer,o=m.url.getQueryValue(t,"entry")||"";if(""==o){for(var a in e)if(i.match(e[a])){o="qb_"+a+"_none";break}o=""==o?"qb_none_none":o}F.context("extra").entry=o}();var A=null,E=F.context("visitJoin"),B=m("#visit-join-model-template"),L=!1;!function(){if(!m(".wgt-search-relate").length){m("<a/>").html('<span class="iknow-icons">&#xe631;</span>搜索资料').addClass("search-relate").attr("href","http://www.baidu.com/s?wd="+encodeURIComponent(F.context("page").title)+"&ie=utf-8").attr("target","_blank").hide().insertBefore("#answer-bar")}}(),("1"!==F.context("page").isView||"1"===F.context("isExpandAnswer")||F.context("page").qid===localStorage.getItem("HAS_NOT_COMMIT_ID")&&"1"===F.context("user").isLogin)&&m(function(){h.addKey({auto_expand_editor:1}),k=k||o(x.content),x(k),k.addListener("ready",function(){localStorage.getItem("HAS_NOT_COMMIT_CONTENT")&&F.context("page").qid===localStorage.getItem("HAS_NOT_COMMIT_ID")&&k.setEditorContent(localStorage.getItem("HAS_NOT_COMMIT_CONTENT"))}),m(".wgt-search-relate, .search-relate").show(),"1"===F.context("isExpandAnswer")&&"1"===F.context("page").isView&&(I="up")})});